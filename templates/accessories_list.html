{% extends 'base.html' %}
{% load static %}
{% load custom_tag %}
{% block meta %}
        <meta name="{{ list.first.accessories_type.meta_name }}" content="{{ list.first.accessories_type.meta_description }}">
        <title>{{ list.first.accessories_type.meta_title }}</title>
{% endblock %}

{% block content %}

	{% if list %}
	<div>

		<div>
           <div class="bg-light p-2 mb-3">
            <form method="GET" id="remove_form" onsubmit="" style="width: 80%;margin: auto"
                  class="d-flex justify-content-around my-2 menu" action="{% url 'application:accessories-list' list.first.accessories_type.pk %}">
{#                {{ search.form }}#}
                <label class="align-self-center">Min value: £ <span id="output_min">0</span></label>
                <input type="range" name="price__gte" id="search_in" class="menu bottom" value="0" oninput="change(event)" step="any" max="1000" min="0">
                <label for="" class="align-self-center">Max Value: £ <span id="output_max">1000</span></label>
                <input type="range" name="price__lte" id="search_in" class="menu bottom" value="1000" step="any" max="1000" min="0" oninput="change(event)">

                <button class="btn btn-success align-self-center">Apply Filter</button>
                <a href="{% url 'application:accessories-list' list.first.accessories_type.pk %}" class="align-self-center btn btn-secondary">Remove Filters</a>
            </form>

        </div>

		</div>

        <div class="container text-center my-2">
                <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="{% new_url 1 'page' request.GET.urlencode %}">&laquo; first</a>
            <a href="{% new_url page_obj.previous_page_number 'page' request.GET.urlencode %}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="{% new_url page_obj.next_page_number 'page' request.GET.urlencode %}">next</a>
            <a href="{% new_url page_obj.paginator.num_pages 'page' request.GET.urlencode %}">last &raquo;</a>
        {% endif %}
    </span>
            </div>

		<div>
			{% for item in list %}

            <div class="border border-rounded d-flex justify-content-around mb-5 menu" id="search_in" style="width: 60%;margin: auto">
                <div style="width: fit-content;" id="contain">
                    <img src="{{ item.get_photo_url }}" loading="lazy" id="k_img" height="245px"       alt="">
                </div>

                <div class="align-self-center ml-5" style="width: 374px" id="contain">
                    <h5 style="color: rgb(46, 154, 135)"><a href="{% url 'application:accessories-detail' item.accessories_type.slug item.pk  %}" style="color:rgb(46, 154, 135)" >{{ item.description }}</a></h5>
                    <h4>£ {{ item.price|floatformat:"0" }}</h4>
                    <p>{{ item.accessories_type }}</p>
                    <p class="m-0">SKU: {{ item.sku }}</p>
                    <p class="m-0" style="color: green;font-weight: 700" id="add{{ item.pk }}"></p>

{#                    <input type="number" class="" style="width: 40%;display: inline" >#}
                    <a onclick="add_cart_1(event,{{ item.pk }},'create','accessories')"
                       class="btn btn-success">Add to cart</a>
                    <a href="{% url 'application:wishlist' 'accessories' item.pk %}"><img src="{% static 'Svg/heart-regular.svg' %}" height="25px" style="   color: red" alt=""></a>
                </div>
            </div>




			{% endfor %}

        <div class="container text-center my-2">
                <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="{% new_url 1 'page' request.GET.urlencode %}">&laquo; first</a>
            <a href="{% new_url page_obj.previous_page_number 'page' request.GET.urlencode %}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="{% new_url page_obj.next_page_number 'page' request.GET.urlencode %}">next</a>
            <a href="{% new_url page_obj.paginator.num_pages 'page' request.GET.urlencode %}">last &raquo;</a>
        {% endif %}
    </span>
            </div>

		</div>

	</div>
	{% else %}
        <div class="alert alert-primary text-center" role="alert">
            We have noting that matches your filters!!!
        </div>

	{% endif %}


{% endblock %}

{% block script %}
    <script>

        const out_max = document.getElementById('output_max')
        const out_min = document.getElementById('output_min')
        function change(e){
            e.target.previousElementSibling.firstElementChild.innerHTML = parseInt(e.target.value)

        }

            function add_cart_1(e,pk,process,pro){
            {#https://tkc-kitchen.nw.r.appspot.com#}
            const base_url = `${origin}/add-to-cart`
            let url = `${base_url}/${pro}/appliance/${pk}/1/${process}/`
            if (e.target.innerText==='Order sample'){
                url = `${base_url}/${pro}/sample/${pk}/1/${process}/`
            }
            fetch(url)

            .then((res)=>{
                return res.url
            })
            .then((result)=>{
                const check = result.split('/')
                if (check[3]==='login'){
                    location.replace(result)
                }
                else{
                const p = document.getElementById(`add${pk}`)
                p.innerHTML = 'Added to cart!!'
                setTimeout(()=>{
                    p.innerHTML = ''
                },1500)
                }
                cart_count('e')

            })


        }



    </script>

{% endblock %}