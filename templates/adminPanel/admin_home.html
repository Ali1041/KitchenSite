{% load static %}
{% load bootstrap4 %}
{% bootstrap_css %}
{% bootstrap_jquery %}

{% bootstrap_javascript %}
<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://kit.fontawesome.com/359826513d.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="{% static 'js/jquery.js' %}"></script>
    <title>Admin</title>
	    <meta name="vapid-key" content="{{ vapid_key }}">
    {% if user.id %}
        <meta name="user_id" content="{{ user.id }}">
    {% endif %}
        <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
</head>

<body>
    <div>
        <div>
            <div>
    <div class="p-3 bg-light">
    <div class="d-flex justify-content-right">

        <div id="our_info" class="d-flex justify-content-around align-self-center" style="width: 40%">
            <div><i class="fas fa-phone-alt align-self-center"></i>
                <span class="m-0 p-2">08002118289</span></div>


            <div><i class="fas fa-envelope align-self-center"></i>
                <span class="m-0 p-2">service@tkckitchens.co.uk</span></div>



        </div>


        <div id="display_b" class="d-flex justify-content-end align-self-center" style="width: 60%">
            <div id='top-bar' class="align-self-center d-flex justify-content-around" style="width: 40%">
                {% if user.is_superuser %}
                    <a class="a_btn" style="text-decoration: none;color: black;font-weight: 500" href="{% url 'adminPanel:index' %}">Admin Panel</a>
                {% endif %}

                {% if user.is_authenticated %}
                    <a href="{% url 'application:list_wishlist' %}" class="a_btn" style="text-decoration: none;color: black;font-weight: 500">Wishlist</a>
                    <a href="{% url 'application:logout' %}" class="a_btn" style="text-decoration: none;color: black;font-weight: 500">Logout</a>

                {% else %}

                <a href="{% url 'application:login' %}" class="a_btn" style="text-decoration: none;color: black;font-weight: 500">Login</a>
                <a href="{% url 'application:signup' %}" class="a_btn" style="text-decoration: none;color: black;font-weight: 500">Register</a>

                {% endif %}

            </div>

            <div id="search_in" class="d-flex justify-content-center" >
                <form class="m-0 d-flex align-self-center" action="{% url 'application:search' %}" method="POST">
                    {% csrf_token %}
                <input type="text" name="search" placeholder="Search..." class="form-control">
                <button class="btn btn-success">
                    <i class="fas fa-search"></i>
{#                    <img style="position: relative;left: -7%" src="{% static 'Svg/search-solid.svg' %}" height="20px" class="align-self-center" alt="">#}
                </button>
                </form>
            </div>

        </div>


    </div>
</div>

</div>

        </div>



        <div class="my-3 ">
            <div style="width: 90%;margin: auto">
                <i class="fas fa-bars" style="font-size: x-large;cursor: pointer" id="icon"  onclick="my_func(event)"></i>
            </div>
            <div class="fade-out p-5 bg-dark text-white" id="side-bar">
                <div class="d-flex justify-content-between">
                    <h4>Admin Panel</h4>
                    <span class="align-self-center" style="cursor: pointer" onclick="close_func(event)">X</span>
                </div>
                <div>
                    <a class="d-block text-center mb-2 a_btn" style="text-decoration: none;color: white" href="{% url 'application:index' %}">Back to main </a>
                    <a class="d-block text-center mb-2 a_btn" style="text-decoration: none;color: white" href="{% url 'adminPanel:admin-all-orders' %}">All orders</a>
                    <a class="d-block text-center mb-2 a_btn" style="text-decoration: none;color: white" href="{% url 'adminPanel:user' %}">All users</a>
                    <a class="d-block text-center mb-2 a_btn" style="text-decoration: none;color: white" href="{% url 'adminPanel:contact_list' %}">Installation List</a>
                    <a class="d-block text-center mb-2 a_btn" style="text-decoration: none;color: white" href="{% url 'adminPanel:actual-list' %}">Contact List</a>
                    <a class="d-block text-center mb-2 a_btn" style="text-decoration: none;color: white" href="{% url 'adminPanel:accessories' %}">Kitchen Accessories</a>
                    <a class="d-block text-center mb-2 a_btn" style="text-decoration: none;color: white" href="{% url 'adminPanel:brochure-list' %}">Brochure</a>

                    <a class="d-block text-center mb-2 a_btn" style="text-decoration: none;color: white" href="">Logout</a>

                </div>
            </div>
        </div>

        {% block content %}
            <div class="card-deck mb-5 p-5" style="width: 90%;margin: auto">
          <div class="card shadow">
            <div class="card-body">
              <h5 class="card-title"><a class="a_btn" style="text-decoration: none;color: inherit" href="{% url 'adminPanel:admin-kitchen' %}">Kitchen</a></h5>
           </div>
          </div>

          <div class="card shadow">
            <div class="card-body">
              <h5 class="card-title"><a class="a_btn" style="text-decoration: none;color: inherit" href="{% url 'adminPanel:admin-worktop' %}">Worktop</a></h5>
            </div>
          </div>


          <div class="card shadow">
            <div class="card-body">
              <h5 class="card-title"><a class="a_btn" style="text-decoration: none;color: inherit" href="{% url 'adminPanel:admin-appliances' %}">Appliances</a></h5>
            </div>
          </div>

                <div class="card shadow">
            <div class="card-body">
              <h5 class="card-title"><a class="a_btn" style="text-decoration: none;color: inherit" href="{% url 'adminPanel:admin-blog' %}">Blogs</a></h5>
            </div>
          </div>
        </div>
        <div>
            <h5 class="text-center"><a href="{% url 'adminPanel:approve' %}">Approve comments</a></h5>
        </div>

        <div class="text-center my-3">
            <a href="{% url 'adminPanel:bulk' %}" class="btn btn-success">Add bulk data</a>
        </div>

	        <div class="text-center my-3">
	    <a class="btn btn-primary" href="{% url 'adminPanel:all_rooms' %}">See All chat rooms</a>
    </div>


        {% endblock %}

    </div>
    <div class="text-center my-2">
	    <a href="{% url 'adminPanel:push' %}" class="btn btn-warning text-white">Push notification</a>
    </div>

    {% include 'inc/footer.html' %}
</body>
<script >
	const registerSw = async () => {
    if ('serviceWorker' in navigator) {
        const reg = await navigator.serviceWorker.register('sw.js');
        initialiseState(reg)

    } else {
        showNotAllowed("You can't send push notifications ☹️😢")
    }
}

const initialiseState = (reg) => {
    if (!reg.showNotification) {
        showNotAllowed('Showing notifications isn\'t supported ☹️😢');
        return
    }
    if (Notification.permission === 'denied') {
        showNotAllowed('You prevented us from showing notifications ☹️🤔');
        return
    }
    if (!'PushManager' in window) {
        showNotAllowed("Push isn't allowed in your browser 🤔");
        return
    }
    subscribe(reg);
}

const showNotAllowed = (message) => {
    const button = document.querySelector('form>button');
    button.innerHTML = `${message}`;
    button.setAttribute('disabled', 'true');
};
function urlB64ToUint8Array(base64String) {
    const padding = '='.repeat((4 - base64String.length % 4) % 4);
    const base64 = (base64String + padding)
        .replace(/\-/g, '+')
        .replace(/_/g, '/');

    const rawData = window.atob(base64);
    const outputArray = new Uint8Array(rawData.length);
    const outputData = outputArray.map((output, index) => rawData.charCodeAt(index));

    return outputData;
}

const subscribe = async (reg) => {
    const subscription = await reg.pushManager.getSubscription();
    if (subscription) {
        sendSubData(subscription);
        return;
    }

    const vapidMeta = document.querySelector('meta[name="vapid-key"]');
    const key = vapidMeta.content;
    const options = {
        userVisibleOnly: true,
        // if key exists, create applicationServerKey property
        ...(key && {applicationServerKey: urlB64ToUint8Array(key)})
    };

    const sub = await reg.pushManager.subscribe(options);
    sendSubData(sub)
};

const sendSubData = async (subscription) => {
    const browser = navigator.userAgent.match(/(firefox|msie|chrome|safari|trident)/ig)[0].toLowerCase();
    const data = {
        status_type: 'subscribe',
        subscription: subscription.toJSON(),
        browser: browser,
    };

    const res = await fetch('/webpush/save_information', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: {
            'content-type': 'application/json'
        },
        credentials: "include"
    });

    handleResponse(res);
};

const handleResponse = (res) => {
    console.log(res.status);
};

registerSw()
</script>

<script>

	function openChat(e){
	    fetch(`${location.origin}/adminPanel/create-room/`)
		.then((res)=>{
		    {#console.log(res.json())#}
		    return res.json()
		})
		.then((result)=>{
		    console.log(result)
		    console.log(result.Msg)
		})

	    e.target.parentElement.nextElementSibling.style.display = 'block'
	}

	function closeChat(e){
	    document.getElementById('chatDiv').style.display = 'none'
	}

    const sidebar=document.getElementById('side-bar')
    const icon = document.getElementById('icon')
    function my_func(e){
        sidebar.classList.remove('fade-out')
        sidebar.classList.add('fade-in')
    }
    function close_func(e){
        sidebar.classList.remove('fade-in')
        sidebar.classList.add('fade-out')
    }
    setTimeout(()=>{
        document.getElementById('pop-up').style.display = 'block'
    },10000)
	function closePopup(e){
	    document.getElementById('pop-up').style.display = 'none'
	}
</script>
</html>