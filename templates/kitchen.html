{% extends 'base.html' %}
{% load bootstrap4 %}
{% bootstrap_css %}
{% bootstrap_jquery %}
{% bootstrap_javascript %}
{% load custom_tag %}

    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.js"></script>

{% block content %}
    <div class="my-5 container" id="container_remove">
        <h2 class="text-center"><span style="color: rgb(46, 154, 135)">{{ kitchen_view }}</span></h2>
        <div style="width: 100%;margin: auto">


            <div id="carouselExampleControls" class="carousel slide " data-ride="carousel">
              <div class="carousel-inner" id="slider_get">
                  {% for pics in kitchen_color %}
                <div class="carousel-item bg-dark get" >
                  <img class="d-block w-100" id="k_img"  style="opacity:0.7;height: 700px" src="{{ pics.get_photo_url }}" alt="{{ pics.color }}">
                </div>
                  {% endfor %}
              <a class="carousel-control-prev"  style="color: black!important;" href="#carouselExampleControls" role="button" data-slide="prev">
                <div class="p-3 bg-dark" style="">
                    <span class="carousel-control-prev-icon"  style="color: black!important;" aria-hidden="true"></span>
                    <span class="sr-only" style="padding: 20px!important;" id="arrow_left">Previous</span>
                </div>
              </a>
              <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                <div class="p-3 bg-dark">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </div>
              </a>
            </div>
            </div>


            <div class="container my-2">
                <p>{{ kitchen_color.first.description }}</p>
            </div>

        </div>
        {% if not form %}
        <div class="d-flex justify-content-between menu">

            <div style="width:30%" id="search_in" class="p-3 align-self-center" >
                <form action="{% url 'application:kitchen-view' kitchen_view.pk %}" id="filter" class="text-center" >
                    <select name="unit_type" id="" class="form-control  mb-2">
                        <option value="" >Select a unit</option>
                        {% for item in search %}
                            <option value="{{ item.pk }}">{{ item }}</option>
                        {% endfor %}
                    </select>
                    <button class="btn btn-success">Apply filter</button>
                    <a href="{% url 'application:kitchen-view' kitchen_view.pk %}" class="btn btn-secondary">Remove filter</a>
                </form>
            </div>

            <div class="align-self-start text-center p-3">
                <a href="{% url 'application:add-to-cart' 'sample' 'white' kitchen_view.pk 1 'create' %}" class="btn btn-success">Order a sample</a>
            </div>
            <div class=" p-3 align-self-start" id="search_in" style="width: 30%">
{#                <label for="">Kitchen Color</label>#}
                <select name="" id="select" class="form-control" onchange="change_url(event)">
                    <option value="">Select Kitchen color</option>
                    {% for item in kitchen_color %}
                        <option value="{{ item.color }}">{{ item.color }}</option>
                    {% endfor %}
                </select>
            </div>

        </div>
        {% endif %}
        {% if units %}
        {% if user.is_authenticated %}
            <div class="container">
                <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="{% new_url 1 'page' request.GET.urlencode %}">&laquo; first</a>
            <a href="{% new_url page_obj.previous_page_number 'page' request.GET.urlencode %}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="{% new_url page_obj.next_page_number 'page' request.GET.urlencode %}">next</a>
            <a href="{% new_url page_obj.paginator.num_pages 'page' request.GET.urlencode %}">last &raquo;</a>
        {% endif %}
    </span>
            </div>
        <table class="table table-striped table-responsive1" >
            <thead>
                <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Price(Including V.A.T)</th>
                    <th>Qty</th>
                    <th>Add to cart</th>
                </tr>
            </thead>
            <tbody id="table">

            {% for item in units %}
                <tr>
                    <td><img src="{{ item.get_photo_url }}" loading="lazy" width="70px" height="70px" alt=""></td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.unit_type }}</td>
                    <td>{{ item.description }}</td>
                    <td>£ {{ item.price }}</td>
                    <td><input type="number" value="1" class="form-control input" style="width: 60%;" min="1"></td>
                    <td><a id="url" style="color: rgb(46, 154, 135);cursor: pointer"
                           onclick="stop(event,'kitchen',`{{ item.kitchen }}`,`{{ item.pk }}`,'create')" ><i class="fas fa-cart-plus" style="font-size: large"></i></a></td>

                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
            <div class="alert alert-primary text-center p-2 my-1" role="alert">
                Login or register to view our prices and latest offers. <a href="{% url 'application:login' %}">Login here</a>
            </div>
        {% endif %}
        <div class="d-flex justify-content-around my-3 menu p-2">
            <a href="{{ kitchen_color.first.doors_guide }}" class="btn btn-success menu bottom">Door Guide</a>
            <a href="{{ kitchen_color.first.tall_unit_guide }}" class="btn btn-success menu bottom">Tall Unit Guide</a>
            <a href="{{ kitchen_color.first.x_tall_unit_guide }}" class="btn btn-success menu bottom">Extra Tall Unit Guide</a>
            <a href="{{ kitchen_color.first.carcases_tech_guide }}" class="btn btn-success menu bottom">Carcases Tech Guide</a>
        </div>
        {% else %}
        <div class="alert alert-primary" role="alert">
            No units!!
        </div>
            <div style="width: 60%;margin: auto" class="border p-5" id="search_in">
        <form action="{% url 'application:installation_contact' %}" method="POST">
            {% csrf_token %}
            <h3 class="text-center">Installation form</h3>
            <label for="" class="d-block">
                Name
                <input placeholder="Name" type="text" name="name" class="form-control">
            </label>

            <label for="" class="d-block">
                Email Address
                <input placeholder="Email" type="email" name="email" class="form-control">
            </label>

            <label for="" class="d-block">
                Phone Number
                <input placeholder="Phone Number" type="number" name="phone" class="form-control">
            </label>

            <label for="" class="d-block">
                Site Address
                <input placeholder="Site Address" type="text" name="address" class="form-control">
            </label>

            <label for="" class="d-block my-4">
                Is room ready to measure?<br/>
                <input type="radio" name="measure" value="True"><span class="ml-2">Yes</span><br/>
                <input type="radio" name="measure" value="False"><span class="ml-2">No</span>
            </label>

            <label for="" class="d-block my-4">
                Do you want us to remove the old kitchen?<br/>
                <input type="radio" name="old" value="True"><span class="ml-2">Yes</span><br/>
                <input type="radio" name="old" value="False"><span class="ml-2">No</span>
            </label>

            <label for="" class="d-block my-4">
                Do you require Plastering, Plumbing & Electrics?<br/>
                <input type="radio" name="ee" value="True"><span class="ml-2">Yes</span><br/>
                <input type="radio" name="ee" value="False"><span class="ml-2">No</span>
            </label>

            <label for="" class="d-block my-4">
                What is your budget on the project Including Cabinets, Worktops, Appliances, Accessories and Installation?<br/>
                <input type="radio" name="price" value="12,000-"><span class="ml-2">£ 10,000-12,000</span><br/>
                <input type="radio" name="price" value="14,000-"><span class="ml-2">£ 12,000-14,000</span><br/>
                <input type="radio" name="price" value="16,000-"><span class="ml-2">£ 14,000-16,000</span><br/>
                <input type="radio" name="price" value="18,000-"><span class="ml-2">£ 16,000-18,000</span><br/>

                <input type="radio" name="price" value="20,000+" ><span class="ml-2">£ 20,000+</span>
            </label>


            <label for="" class="d-block">
                Anything else you want to tell us?
                <textarea placeholder="Additional Detail" class="form-control" name="detail"></textarea>
            </label>
            <button class="btn btn-success">Submit</button>
        </form>
    </div>

    {% endif %}
    </div>

    <div id="cart" style="
    transition: all 0.3s ease-in-out;display: block;position: fixed;left: 45%;bottom: -8%;
    background-color: forestgreen;border-radius: 8px"
         class="text-white p-2">
        Added to cart!!
    </div>

{% endblock %}
{% block script %}
    <script>
    const img = document.getElementsByClassName('get')
    img[0].classList.add('active')
    const slider = document.getElementById('slider_get').children
    const div = document.getElementById('cart')

    function stop(e,status,kit,pk,pro){
        const s = document.getElementById('select')
        if (s.value===''){
            alert('Select a color')
        }
        else{
            const qty = e.target.parentElement.parentElement.previousElementSibling.firstElementChild.value
            const base_url = 'http://127.0.0.1:8000/add-to-cart'
            let url = `${base_url}/${s.value}/${kit}/${pk}/${qty}/${pro}/`
            fetch(url)
            .then((res)=>{
                return res.json()
            })
            .then((result)=>{
                div.style.bottom = 10+'%'
                setTimeout(()=>{
                    div.style.bottom = -10+'%'
                },1500)
                return result
            })
        }
    }

    function change_url(e){

        const color = e.target.value
    for (let i=0;i<slider.length-2;i++){
        if (slider[i].firstElementChild.alt===color){
            slider[i].classList.add('active')
        }
        else{
            slider[i].classList.remove('active')
        }
    }

    }


    </script>

{% endblock %}