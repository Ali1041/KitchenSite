{% extends 'base.html' %}
{% load static %}
{% load custom_tag %}

    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.js"></script>
    {% block meta %}
        <meta name="{{ current_kitchen.first.kitchen_type.meta_name }}" content="{{ current_kitchen.first.kitchen_type.meta_description }}">
        <title>{{ current_kitchen.first.kitchen_type.meta_title }}</title>
    {% endblock %}
	{% block og %}
	<meta property="og:title" content="{{ current_kitchen.first.kitchen_type.meta_title }}" />
	<meta property="og:type" content="website" />
	<meta property="og:description" content="{{ current_kitchen.first.kitchen_type.meta_description }}" />
	<meta property="og:locale" content="en_GB" />
	<meta property="og:image" content="{{ current_kitchen.first.get_photo_url }}" />
	<meta property="og:url" content="{{ can_tag }}" />


	<meta name="twitter:card" content="summary" />
	<meta name="twitter:title" content="{{ current_kitchen.first.kitchen_type.meta_title }}" />
	<meta name="twitter:description" content="{{ current_kitchen.first.kitchen_type.meta_description }}" />
	<meta name="twitter:image" content="{{ current_kitchen.first.get_photo_url }}" />
	<meta name=”twitter:url” content="{{ can_tag }}" />
	{% endblock %}
{% block content %}





    <div class="my-5 container" id="container_remove">
        <h1 class="text-center"><span style="color: rgb(46, 154, 135)">{{ item }}</span></h1>
        <div>

			{#    Image of kitchen    #}
	        <div class="shadow mx-auto" style="width: fit-content">
			      <img class="d-block" id="k_img" style="max-width: 100%" height="700px" src="{{ item.get_photo_url }}" alt="{{ item.get_alt_text }} TKC-kitchen pic">
	        </div>

			{#     Colors available       #}
            <div class="d-flex my-3" id="display_b" style="width: 50%;margin: auto" >
                <p class="m-0 align-self-center text-center w-25" id="search_in"><b>Colors Available: </b></p>
                <div class="d-flex justify-content-between ml-3 w-75" id="search_in">
                {% for item in kitchen_color %}
                    <p class="m-0 align-self-center" onclick="change_url(`{{ item.color }}`,`{{ kitchen_view.name }}`)" style="cursor: pointer;border: 1px solid lightgrey;width: 30px;height: 30px;background-color: var(--{{ item.color }})"></p>

                {% endfor %}
                </div>
            </div>

            <div class="container my-2">
                <p>{{ item.description }}</p>
            </div>

        </div>
        {% if not form %}
        <div >
            <div class="text-center p-3">
                <a href="{% url 'application:contact' %}" class="btn btn-success" >Order a free sample</a>
            </div>

{#	Units search		#}
	        <div class="mx-auto p-3" id="search_in" style="width: 30%">
	            <div class="btn-group border p-2 " style="width: 100%;border-radius: 6px">

		            <p class="align-self-center m-0 mr-2" style="border: 1px solid lightgrey;height: 30px;width: 30px;background-color: var(--{{ current_color }})">
		            </p>
		            <a style="font-weight: 600;text-decoration: none;cursor:pointer;color:inherit"
		               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class=" a_btn dropdown-toggle" id="select">(Selected Color) {{ current_color }}</a>

		            <div class="dropdown-menu p-0 w-100">
			            {% for item in kitchen_color %}
				            <div class="dropdown-item a_btn d-flex" onclick="change_url(`{{ item.color }}`,`{{ kitchen_view.name }}`)" style="cursor:pointer">
			          <p class="align-self-center m-0 mr-2" style="border: 1px solid lightgrey;display: inline-block;height: 30px;width: 30px;background-color: var(--{{ item.color }})"></p>
                        <h6 class="align-self-center">{{ item.color }}</h6>
		          </div>
			            {% endfor %}
		            </div>

	            </div>
	        </div>
        </div>
            {% else %}
{#	  Mobile dropdown colors      #}
            <div style="width: 80%;margin: auto">
                    <div class="btn-group border p-2 my-2" style="width: 100%;border-radius: 6px">
                        <p class="align-self-center m-0 mr-2" style="height: 20px;width: 20px;background-color: var(--{{ current_color }})">
                        </p>

	                    <a style="font-weight: 600;text-decoration: none;cursor:pointer;color:inherit" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class=" a_btn dropdown-toggle" id="select">(Selected Color) {{ current_color }}</a>

	                    <div class="dropdown-menu p-0 w-100">
		                    {% for item in kitchen_color %}
			                    <div class="dropdown-item dropHover a_btn d-flex" onclick="change_url(`{{ item.color }}`)" style="cursor:pointer">
				                    <p class="align-self-center m-0 mr-2" style="display: inline-block;height: 20px;width: 20px;background-color: var(--{{ item.color }})">
			                        </p>
			                        <span class="">{{ item.color }}</span>
			                    </div>
		                    {% endfor %}
	                    </div>
                    </div>
            </div>
        {% endif %}
		{% include 'inc/kitchen_video.html' %}

        {% if units %}
	        {% if not user.is_authenticated %}
	        <div class="alert alert-primary text-center p-2 my-1" role="alert">
                <span style="font-weight: 700">Units starting from £113, Log in to select units, view prices and get access to our latest offers. </span><a class="btn btn-success" href="{% url 'application:login' %}">Login Here or Register Now</a>
            </div>
	        {% endif %}
	        <div class="d-flex justify-content-between" id="display_b">
	        <div style="width:30%" id="search_in" class="align-self-start" >
                <form  id="filter" class="text-center" action="{% url 'application:kitchen-view' kitchen_view.name current_color   %}" >
                    <select name="unit_type" id="" class="form-control  mb-2">
                        <option value="" >Select a unit</option>
                        {% for item in search %}
                            <option value="{{ item.pk }}">{{ item }}</option>
                        {% endfor %}
                    </select>
                    <button class="btn btn-success">Apply filter</button>
                    <a href="{% url 'application:kitchen-view' kitchen_view.name current_color %}" class="btn btn-secondary">Remove filter</a>
                </form>
            </div>

				<div class="align-self-start mtb" id="abs"  >
					<form class="ml-auto w-100 d-flex">
						<input type="text" class="form-control" oninput="searchUnits(event)" onblur="removeDiv(event)" required name="name__icontains" placeholder="Search units..">
						<button class="btn btn-success"><i class="fas fa-search"></i></button>
					</form>
					<div style="" class="bg-white p-2" id="add-units">

					</div>
				</div>
	        </div>


	        <div class="container text-center">
		        <span class="step-links">
			        {% if page_obj.has_previous %}
			            <a href="{% new_url 1 'page' request.GET.urlencode %}">&laquo; first</a>
			            <a href="{% new_url page_obj.previous_page_number 'page' request.GET.urlencode %}">previous</a>
			        {% endif %}

			        <span class="current">
				        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
			        </span>

			        {% if page_obj.has_next %}
			            <a href="{% new_url page_obj.next_page_number 'page' request.GET.urlencode %}">next</a>
			            <a href="{% new_url page_obj.paginator.num_pages 'page' request.GET.urlencode %}">last &raquo;</a>
			        {% endif %}
		        </span>
	        </div>

			{% include 'inc/kitchen_table.html' %}
	        <div class="container d-flex justify-content-between">
		        <div>
			        <span class="step-links">
				        {% if page_obj.has_previous %}
					        <a class="btn btn-theme" href="{% new_url 1 'page' request.GET.urlencode %}">&laquo; first</a>
					        <a class="btn btn-theme" href="{% new_url page_obj.previous_page_number 'page' request.GET.urlencode %}">previous</a>
				        {% endif %}


				        <span class="current">
					        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
				        </span>

				        {% if page_obj.has_next %}
				            <a class="btn btn-theme" href="{% new_url page_obj.next_page_number 'page' request.GET.urlencode %}">next</a>
				            <a class="btn btn-theme" href="{% new_url page_obj.paginator.num_pages 'page' request.GET.urlencode %}">last &raquo;</a>
				        {% endif %}
			        </span>
		        </div>
		        <div>
			        <a href="{% url 'application:cart' %}" class="btn btn-success">Proceed to cart</a>
		        </div>
	        </div>

	        <div class="d-flex justify-content-around my-3 p-2">
	            <a href="{{ current_kitchen.doors_guide }}" class="btn btn-success bottom">Door Guide</a>
	            <a href="{{ current_kitchen.tall_unit_guide }}" class="btn btn-success bottom">Tall Unit Guide</a>
	            <a href="{{ current_kitchen.x_tall_unit_guide }}" class="btn btn-success bottom">Extra Tall Unit Guide</a>
	            <a href="{{ current_kitchen.carcases_tech_guide }}" class="btn btn-success bottom">Carcases Tech Guide</a>
	        </div>
        {% else %}
	        <div class="alert alert-primary" role="alert">
		        No units!!
	        </div>
	        {% if form %}
		        <div id="contain">

		        </div>
		        {% include 'inc/kitchen_form.html' %}
	        {% endif %}
        {% endif %}
    </div>

	<div id="cart" style="
    transition: all 0.3s ease-in-out;display: block;position: fixed;left: 45%;bottom: -8%;
    background-color: forestgreen;border-radius: 8px"
         class="text-white p-2">
		Added to cart!!
	</div>

	<div id="fixed" class="bg-white" style="position: fixed;top: 20%;left: 20%;display: none">
		<p class="m-0 btn btn-danger text-right d-none">x</p>
		<img src="" height="350px" alt="Image">
	</div>
{{ current_kitchen.first.kitchen_type.name|json_script:'name' }}
	{{ current_kitchen.first.color|json_script:'color' }}
	{{ request.user.username|json_script:'username' }}
{% endblock %}
{% block script %}
	<script type="text/javascript" src="{% static 'js/kitchen.js' %}"></script>
    <script>
	    const dropdown = document.getElementById('add-units')
		const kitchenName = JSON.parse(document.getElementById('name').textContent);
		const color = JSON.parse(document.getElementById('color').textContent);
		const username = JSON.parse(document.getElementById('username').textContent);


            function searchUnits(e){
                fetch(`${location.origin}/search-units/${e.target.value}/${kitchenName}/`)
	            .then((res)=>{
	                return res.json()
	            })
	            .then((result)=>{
		            const resultArray = JSON.parse(result.response)
		            dropdown.style.display = 'block'
		            dropdown.innerHTML = ''
					resultArray.forEach((item)=>{
						const a = document.createElement('a')
						a.innerText = item.fields.name +' : '+item.fields.description
						a.classList.add('p-2','d-block')
						a.setAttribute('href',`${location.origin}/kitchen-view/unit/${kitchenName}/${color}/${item.pk}/`)
						a.addEventListener('click',()=>{
						    location.assign(`${location.origin}/kitchen-view/unit/${kitchenName}/${color}/${item.pk}/`)
						})
						dropdown.append(a)
					})
	            })
	            .catch((err,res)=>{
	                dropdown.style.display = 'block';
		            dropdown.style.minHeight = 'fit-content';
	                dropdown.innerHTML = 'No results';
	            })
            }
            function removeDiv(e){
                setTimeout(()=>{
                    dropdown.style.display = 'none'

                },500)
            }






    </script>

{% endblock %}