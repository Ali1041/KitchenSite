{% extends 'base.html' %}
{% load static %}
{% load bootstrap4 %}
{% block content %}

    <div class="my-3">
    {% ifequal product 'worktop' %}
        <div class="bg-light p-2 mb-3">
            <form method="GET" id="remove_form" style="width: 80%;margin: auto"
                  class="d-flex justify-content-around my-2 menu" action="{% url 'application:worktop-view' list.first.category.pk %}">
                {{ search.form }}
                <button class="btn btn-success align-self-center">Apply Filter</button>
                <a href="{% url 'application:worktop-view' list.first.category.pk %}" class="align-self-center btn btn-secondary">Remove Filters</a>
            </form>

        </div>

        <div class="container text-center my-2">
                <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
            </div>
        {% for item in list %}
            <div class="border border-rounded d-flex mb-5 menu pb-3 " id="search_in" style="width: 60%;margin: auto">
                <div style="width: fit-content;" id="contain">
                    <img src="{{ item.get_photo_url }}" class="img1" height="245px" width="367px"     alt="">
                </div>

                <div class="align-self-center ml-5" id="contain">
                    <h5 style="color: rgb(46, 154, 135)"><a href="{% url 'application:worktop-detail-view' 'worktop' item.pk %}" style="text-decoration: none;color: inherit" >{{ item }}</a></h5>
                    <h4>£ {{ item.price }}</h4>
                    <p>{{ item.description }}</p>
                    <p>Dimension/Size: {{ item.size }}</p>
{#                    <input type="number" class="" style="width: 40%;display: inline" >#}
                    <a onclick="add_cart_1(event,{{ item.pk }},'create','worktop')"
                       class="btn btn-success">Add to cart</a>
                    <a href="{% url 'application:wishlist' 'worktop' item.pk %}"><img src="{% static 'Svg/heart-regular.svg' %}" height="25px" style="   color: red" alt=""></a>
                </div>
            </div>

        {% endfor %}
    {% else %}

        {% if list %}

            <div class="bg-light p-2 mb-3">
            <form method="GET" id="remove_form" style="width: 80%;margin: auto"
                  class="d-flex justify-content-around my-2 menu" action="{% url 'application:appliances-list' list.first.category.pk %}">
                {{ search.form }}
                <button class="btn btn-success align-self-center">Apply Filter</button>
                <a href="{% url 'application:appliances-list' list.first.category.pk %}" class="align-self-center btn btn-secondary">Remove Filters</a>
            </form>

        </div>

                    <div class="container">
                <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
            </div>
        {% for item in list %}
            <div class="border border-rounded d-flex mb-5 menu" id="search_in" style="width: 60%;margin: auto">
                <div style="width: fit-content;" id="contain">
                    <img src="{{ item.get_photo_url }}" id="k_img" height="245px" width="367px"     alt="">
                </div>

                <div class="align-self-center ml-5" id="contain">
                    <h5 style="color: rgb(46, 154, 135)"><a href="{% url 'application:worktop-detail-view' 'appliance' item.pk %}" >{{ item }}</a></h5>
                    <h4>£ {{ item.price }}</h4>
                    <p>{{ item.description|truncatewords:15 }}</p>
                    <p>Type: {{ item.appliances_type }}</p>
                    <p>Brand: {{ item.brand_name }}</p>
{#                    <input type="number" class="" style="width: 40%;display: inline" >#}
                    <a onclick="add_cart_1(event,{{ item.pk }},'create','appliance')"
                       class="btn btn-success">Add to cart</a>
                    <a href="{% url 'application:wishlist' 'appliance' item.pk %}"><img src="{% static 'Svg/heart-regular.svg' %}" height="25px" style="   color: red" alt=""></a>
                </div>
            </div>

        {% endfor %}

        {% else %}
        <div class="alert alert-primary text-center mt-2" role="alert">
            No item matching your query was found!!
            <a href="{% url 'application:index' %}">Back to main page</a>
        </div>
        {% endif %}
    {% endifequal %}
    </div>

    <script>
            const product = `{{ product }}`;
            let q = 0
            if (product==='worktop'){
                q = 2
            }
            else{
                q=3
            }
            const form = document.getElementById('remove_form').children
            for (let i=0;i<=q;i++){
            if (form[0]||i%2){
                const place = form[i].innerHTML
                form[i].remove()
                form[i].setAttribute('class','form-control mr-2 my-2')
                form[i].setAttribute('placeholder',place)
                if (window.innerWidth<768){
                    form[i].style.width = 100+'%'
                }
            else {


                    form[i].style.width = 17 + '%';
                }
            }

       }

            function add_cart_1(e,pk,process,pro){
            console.log(pk,process,pro)
            const base_url = 'http://127.0.0.1:8000/add-to-cart'
            fetch(`${base_url}/${pro}/appliance/${pk}/1/${process}/`)

            .then((res)=>{
                return res.json()
            })
            .then((result)=>{
                return
            })
        }



    </script>

{% endblock %}